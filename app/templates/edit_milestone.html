{% extends "base.html" %}

{% block title %}Edit Milestone{% endblock %}
{% block body_class %}milestone-body{% endblock %}

{% block content %}
<div class="milestone-form">

    <h2 class="text-center mb-4">Edit Milestone</h2>

    <a href="{{ url_for('main.roadmap_overview', project_id=milestone.roadmap.id_project) }}"
       class="btn btn-nav mb-3">
        ‚Üê Back to Roadmap
    </a>

    <form method="POST">

        <!-- NAME -->
        <div class="mb-3">
            <label class="form-label fw-bold">Milestone Name</label>
            <input type="text" name="name" class="form-control"
                   value="{{ milestone.name }}" required>
        </div>

        <!-- DATES -->
        <div class="row">
            <div class="col mb-3">
                <label class="form-label fw-bold">Start Date</label>
                <input type="date" name="start_date" class="form-control"
                       value="{{ milestone.start_date }}">
            </div>

            <div class="col mb-3">
                <label class="form-label fw-bold">End Date</label>
                <input type="date" name="end_date" class="form-control"
                       value="{{ milestone.end_date }}">
            </div>
        </div>

        <!-- GOAL -->
        <div class="mb-3">
            <label class="form-label fw-bold">Goal</label>
            <textarea name="goal" class="form-control" rows="3">{{ milestone.goal }}</textarea>
        </div>

        <!-- STATUS -->
        <div class="mb-3">
            <label class="form-label fw-bold">Status</label>
            <select name="status" class="form-select" required>
                <option value="Planned" {% if milestone.status == "Planned" %}selected{% endif %}>Planned</option>
                <option value="In Progress" {% if milestone.status == "In Progress" %}selected{% endif %}>In Progress</option>
                <option value="Done" {% if milestone.status == "Done" %}selected{% endif %}>Done</option>
            </select>
        </div>

        <!-- üî• FEATURE MULTI-SELECT -->
        <hr class="my-4">
        <h4 class="mb-3">Assigned Features (sorted by VECTR score)</h4>

        <div class="mb-3">
            <label class="form-label">Select features for this milestone</label>

            <select name="features" multiple class="form-select" size="8">
                {% for f in features %}
                    <option value="{{ f.id_feature }}"
                        {% if f.id_feature in selected_features %}selected{% endif %}
                    >
                        {{ f.name_feature }}
                        ‚Äî VECTR:
                        {% if f.vectr_score %}
                            {{ "%.2f"|format(f.vectr_score) }}
                        {% else %}
                            N/A
                        {% endif %}
                    </option>
                {% endfor %}
            </select>

            <small class="text-muted">
                Hold CTRL (Windows) or CMD (Mac) to select multiple features.
            </small>
        </div>

        <!-- SUBMIT -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary-custom px-4">
                Save Changes
            </button>
        </div>

    </form>

</div>
{% endblock %}
