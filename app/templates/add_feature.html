<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add New Feature</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    body { background-color: #e9f4ff; }
    .container { max-width: 1100px; margin-top: 40px; }
    .section-card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      padding: 20px;
      margin-bottom: 20px;
    }

    .top-right {
      position: absolute;
      top: 15px;
      right: 20px;
    }

    .form-label { font-weight: 600; }

    .formula { font-style: italic; color: #555; margin-bottom: 10px; }

    .btn-save { float: right; min-width: 160px; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }

    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 18px; }

  </style>
</head>
<body>
  <div class="top-right">
    <a href="{{ url_for('main.projects') }}" class="btn btn-dark btn-sm">Go to Projects</a>
  </div>

  <div class="container">
    <h2 class="mb-4">Add New Feature</h2>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category in ['danger','error'] else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="post" action="{{ url_for('main.add_feature', project_id=project.id_project) }}"></form>
      
      <!-- Basic info -->
      <div class="section-card">
        <h4 class="mb-3">Basic info</h4>
        <div class="grid-2">
          <div>
            <label class="form-label" for="name_feature">Title</label>
            <input type="text" class="form-control" id="name_feature" name="name_feature" required>
          </div>
          <div>
            <label class="form-label">Project</label>
            <!-- Toon projectnaam readonly -->
            <input type="text" class="form-control" value="{{ project.project_name }}" readonly>
            <!-- Hidden inputs om id_project en id_company mee te sturen -->
            <input type="hidden" id="id_project" name="id_project" value="{{ project.id_project }}">
            <input type="hidden" id="id_company" name="id_company" value="{{ company.id_company }}">
          </div>
        </div>
        <div class="mt-3">
          <label class="form-label" for="description">Description</label>
          <textarea class="form-control" id="description" name="description" rows="3"></textarea>
        </div>
      </div>

      <!-- ROI -->
      <div class="section-card">
        <h4 class="mb-3">Return on Investment (ROI)</h4>
        <p class="formula">
          <strong>Total Gains =</strong> revenue + churn + cost savings<br>
          <strong>Total Costs =</strong> development + OPEX + other
        </p>

        <!-- Expected Profit over Horizon H -->
        <h5 class="mt-4">Expected Profit over Horizon H</h5>
        <div class="grid-2">
          <div>
            <label class="form-label" for="horizon">Horizon (months)</label>
            <input type="number" class="form-control" id="horizon" name="horizon" min="0">
          </div>
          <div>
            <label class="form-label" for="extra_revenue">Extra revenue</label>
            <input type="number" class="form-control" id="extra_revenue" name="extra_revenue" min="0">
          </div>
          <div>
            <label class="form-label" for="churn_reduction">Churn reduction savings</label>
            <input type="number" class="form-control" id="churn_reduction" name="churn_reduction" min="0">
          </div>
          <div>
            <label class="form-label" for="cost_savings">Cost savings</label>
            <input type="number" class="form-control" id="cost_savings" name="cost_savings" min="0">
          </div>
        </div>

        <!-- Investment Cost -->
        <h5 class="mt-4">Investment Cost</h5>
        <div class="grid-2">
          <div>
            <label class="form-label" for="investment_hours">Development effort (hours)</label>
            <input type="number" class="form-control" id="investment_hours" name="investment_hours" min="0">
          </div>
          <div>
            <label class="form-label" for="opex_hours">OPEX (operational costs)</label>
            <input type="number" class="form-control" id="opex_hours" name="opex_hours" min="0">
          </div>
          <div>
            <label class="form-label" for="other_costs">Other costs (optional)</label>
            <input type="number" class="form-control" id="other_costs" name="other_costs" min="0">
          </div>
        </div>

        <!-- ROI output -->
        <div class="mt-4">
          <label class="form-label" for="roi_percent">ROI (%)</label>
          <input type="text" class="form-control" id="roi_percent" name="roi_percent" placeholder="Calculated automatically" readonly>
        </div>
      </div>

      <!-- TTV -->
      <div class="section-card">
        <h4 class="mb-3">Time to Value (TTV)</h4>
        <p class="formula">TTV = Time-to-Market + Time-to-Business-Value</p>
        <div class="grid-2">
          <div>
            <label class="form-label" for="ttm_weeks">Time-to-Market (weeks)</label>
            <input type="number" class="form-control" id="ttm_weeks" name="ttm_weeks" min="0">
          </div>
          <div>
            <label class="form-label" for="ttbv_weeks">Time-to-Business-Value (weeks)</label>
            <input type="number" class="form-control" id="ttbv_weeks" name="ttbv_weeks" min="0">
          </div>
        </div>
        <div class="mt-3">
          <label class="form-label" for="ttv_weeks">TTV (weeks)</label>
          <input type="text" class="form-control" id="ttv_weeks" name="ttv_weeks" placeholder="Calculated automatically" readonly>
        </div>
      </div>

      <!-- Confidence -->
      <div class="section-card">
        <h4 class="mb-3">Evidence & Confidence Level</h4>
        <label class="form-label" for="quality_score">
          Confidence level
          <a href="#" class="ms-2" data-bs-toggle="modal" data-bs-target="#confidenceModal">
            <i class="bi bi-info-circle"></i>
          </a>
        </label>
        <select class="form-select" id="quality_score" name="quality_score" required>
          <option value="">Select score</option>
          <option value="0.01">Self Conviction — 0.01</option>
          <option value="0.03">Pitch Deck — 0.03</option>
          <option value="0.1">Thematic Support — 0.1</option>
          <option value="0.2">Other’s Opinion — 0.2</option>
          <option value="0.5">Estimates & Plans — 0.5</option>
          <option value="1">Anecdotal Evidence — 1</option>
          <option value="2">Market Data — 2</option>
          <option value="3">User/Customer Evidence — 3</option>
          <option value="7">Test Results — 7</option>
          <option value="10">Launch Data — 10</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary btn-save">Save Feature</button>
    </form>
  </div>
</body>
</html>