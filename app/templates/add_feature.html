<!DOCTYPE html>
<html lang="en">
<!-- head kan gebruiker niet zien -->
<head>
  <meta charset="UTF-8"> <!-- Zorgt dat het document UTF‑8 encoding gebruikt (ondersteunt alle tekens) -->
  <title>Add New Feature</title> <!--Titel van de pagina (verschijnt in browser tab)-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!--custom css-->
  <style> 
    body { background-color: #e9f4ff; }
    .container { max-width: 1100px; margin-top: 40px; }
    .section-card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      padding: 20px;
      margin-bottom: 20px;
    }
    .top-right {
            position: absolute;
            top: 15px;
            right: 20px;
        }
    .form-label { font-weight: 600; }
    .btn-save {
      float: right;
      min-width: 160px;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 18px;
    }
    .grid-1 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
    }
  </style>
  <!-- bootstrap-icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

</head>
<!-- daadwerkelijke inhoud die gebruiker ziet -->
<body>
  <!-- link stuurt gebruiker naar projects -->
  <div class="top-right">
        <a href="{{ url_for('main.projects') }}" class="btn btn-dark btn-sm">Go to Projects</a>
  </div>

    <!--Container centreert inhoud-->
  <div class="container">

    <h2 class="mb-4">Add New Feature</h2>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category in ['danger','error'] else category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="post" action="{{ url_for('main.add_feature') }}">
      <!-- Basic info -->
      <div class="section-card">
        <h4 class="mb-3">Basic info</h4>

        <div class="grid-2">
          <div>
            <label class="form-label" for="name_feature">Title</label>
            <input type="text" class="form-control" id="name_feature" name="name_feature" placeholder="e.g., In-app onboarding tour" required>
          </div>

          <div>
            <label class="form-label" for="id_company">Company</label>
            <select class="form-select" id="id_company" name="id_company" required>
              <option value="">Select company</option>
              {% for c in companies %}
                <option value="{{ c.id_company }}">{{ c.company_name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="grid-2 mt-3">
          <div>
            <label class="form-label" for="id_project">Project</label>
            <select class="form-select" id="id_project" name="id_project" required>
              <option value="">Select project</option>
              <!-- Filled dynamically when company changes -->
            </select>
          </div>

          <div>
            <label class="form-label" for="description">Description (not stored yet)</label>
            <textarea class="form-control" id="description" name="description" rows="3" placeholder="Short explanation of the feature..."></textarea>
            <small class="text-muted">Your current database model doesn’t include a description column. You can add it later if needed.</small>
          </div>
        </div>
      </div>

      <!-- ROI / Kostenwaarden -->
      <div class="section-card">
        <h4 class="mb-3">ROI / Kostenwaarden</h4>

        <div class="grid-3">
          <div>
            <label class="form-label" for="gains">Gains</label>
            <input type="number" class="form-control" id="gains" name="gains" placeholder="0" min="0" required>
          </div>
          <div>
            <label class="form-label" for="costs">Costs</label>
            <input type="number" class="form-control" id="costs" name="costs" placeholder="0" min="0" required>
          </div>
          <div>
            <label class="form-label" for="churn_OPEX">Churn / OPEX</label>
            <input type="number" class="form-control" id="churn_OPEX" name="churn_OPEX" placeholder="0" min="0" required>
          </div>
        </div>

        <div class="grid-3 mt-3">
          <div>
            <label class="form-label" for="opp_cost">Opportunity cost</label>
            <input type="number" class="form-control" id="opp_cost" name="opp_cost" placeholder="0" min="0" required>
          </div>
          <div>
            <label class="form-label" for="market_value">Market value</label>
            <input type="number" class="form-control" id="market_value" name="market_value" placeholder="0" min="0" required>
          </div>
          <div>
            <label class="form-label" for="business_value">Business value</label>
            <input type="number" class="form-control" id="business_value" name="business_value" placeholder="0" min="0" required>
          </div>
        </div>

        <div class="grid-2 mt-3">
          <div>
            <label class="form-label" for="validation_stage">Validation stage</label>
            <select class="form-select" id="validation_stage" name="validation_stage" required>
              <option value="">Select stage</option>
              <option value="1">Idea</option>
              <option value="2">Problem validation</option>
              <option value="3">Solution validation</option>
              <option value="4">MVP</option>
              <option value="5">Post-launch</option>
            </select>
          </div>
          <div>
            <label class="form-label" for="quality_score">
              Confidence level
              <!-- Info-icoon dat modal opent -->
              <a href="#" class="ms-2" data-bs-toggle="modal" data-bs-target="#confidenceModal" aria-label="Meer info over confidence levels">
                <i class="bi bi-info-circle" style="font-size:1.2rem;"></i>
              </a>
            </label>

            <select class="form-select" id="quality_score" name="quality_score" required>
              <option value="">Select score</option>
              <option value="0.01">Self Conviction — 0.01</option>
              <option value="0.03">Pitch Deck — 0.03</option>
              <option value="0.1">Thematic Support — 0.1</option>
              <option value="0.2">Other’s Opinion — 0.2</option>
              <option value="0.5">Estimates &amp; Plans — 0.5</option>
              <option value="1">Anecdotal Evidence — 1</option>
              <option value="2">Market Data — 2</option>
              <option value="3">User/Customer Evidence — 3</option>
              <option value="7">Test Results — 7</option>
              <option value="10">Launch Data — 10</option>
            </select>
          </div>

        </div>
      </div>

      <button type="submit" class="btn btn-primary btn-save">Save Feature</button>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Dynamically load projects when company changes
    document.getElementById('id_company').addEventListener('change', async function () {
      const id_company = this.value;
      const projectSelect = document.getElementById('id_project');
      projectSelect.innerHTML = '<option value="">Loading projects...</option>';

      if (!id_company) {
        projectSelect.innerHTML = '<option value="">Select project</option>';
        return;
      }

      try {
        const res = await fetch(`/projects?id_company=${encodeURIComponent(id_company)}`);
        const data = await res.json();

        projectSelect.innerHTML = '<option value="">Select project</option>';
        (data.projects || []).forEach(p => {
          const opt = document.createElement('option');
          opt.value = p.id_project;
          opt.textContent = p.project_name;
          projectSelect.appendChild(opt);
        });

        if ((data.projects || []).length === 0) {
          const opt = document.createElement('option');
          opt.value = '';
          opt.textContent = 'No projects for this company';
          projectSelect.appendChild(opt);
        }
      } catch (e) {
        projectSelect.innerHTML = '<option value="">Error loading projects</option>';
      }
    });
  </script>
  <!-- Modal voor confidence level uitleg -->
  <div class="modal fade" id="confidenceModal" tabindex="-1" aria-labelledby="confidenceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confidenceModalLabel">Confidence level</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
        </div>

        <div class="modal-body">
          <p>How confident are you about this project’s success, based on the strongest evidence you have? Below you will find the scale with the source, short description and the corresponding confidence score.</p>

          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th>Source</th>
                  <th>Description</th>
                  <th class="text-end">Confidence Score</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>Self Conviction</td><td>Pure intuition</td><td class="text-end">0.01</td></tr>
                <tr><td>Pitch Deck</td><td>Concept with slides</td><td class="text-end">0.03</td></tr>
                <tr><td>Thematic Support</td><td>Trend fits current themes</td><td class="text-end">0.1</td></tr>
                <tr><td>Other’s Opinion</td><td>Expert or peer opinion</td><td class="text-end">0.2</td></tr>
                <tr><td>Estimates &amp; Plans</td><td>Early projections</td><td class="text-end">0.5</td></tr>
                <tr><td>Anecdotal Evidence</td><td>Feedback from few users</td><td class="text-end">1</td></tr>
                <tr><td>Market Data</td><td>Validated by research</td><td class="text-end">2</td></tr>
                <tr><td>User/Customer Evidence</td><td>Real user feedback</td><td class="text-end">3</td></tr>
                <tr><td>Test Results</td><td>Pilot or prototype data</td><td class="text-end">7</td></tr>
                <tr><td>Launch Data</td><td>Proven post-launch</td><td class="text-end">10</td></tr>
              </tbody>
            </table>
          </div>

          <hr>
          <p>Choose the score that best represents the strongest evidence you have—not an average.</p>
        </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
