{% extends "base.html" %}
{% block title %}Evidence for {{ feature.name_feature }}{% endblock %}
{% block body_class %}projects-body{% endblock %}

{% block content %}

<!-- =========================
     NAVIGATIE + USER INFO
     ========================= -->

<div class="top-right-fixed">
  <a href="{{ url_for('main.view_features', project_id=feature.id_project) }}"
     class="btn btn-base btn-nav btn-sm">
    ← Back to Features
  </a>
</div>

<div class="bottom-info">
  Logged in as: <strong>{{ session['name'] }}</strong> |
  Role: <strong>{{ session['role'] }}</strong>
</div>

<!-- =========================
     PAGINATITEL
     ========================= -->
<h2 class="mb-4 text-center">
  Evidence for: {{ feature.name_feature }}
</h2>

<!-- =========================
     HOOFD-CONTAINER (witte kaart)
     ========================= -->
<div class="projects-wrapper">

  {% if evidence_list|length == 0 %}
    <!-- Als er nog geen evidence is, tonen we een simple boodschap -->
    <div class="text-center text-muted py-4">
      No evidence added yet.
    </div>

  {% else %}

    <!-- =========================
         TABEL MET ALLE EVIDENCE
         ========================= -->
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Title</th>
          <th>Type</th>
          <th>Description</th>
          <th>Attachment</th>
          <th>Confidence Level</th>
          <th class="col-actions">Actions</th>
        </tr>
      </thead>

      <tbody>

        {% for ev in evidence_list %}
        {% set label = CONFIDENCE_LABELS.get(ev.new_confidence, "Unknown") %} <!-- haalt mooie tekst (label) op bij de numerieke confidence-score -->

        <tr>

           
          <td>{{ ev.title }}</td>  <!-- Titel van de evidence, bv. “Customer interview #3” -->

          
          <td>{{ ev.type }}</td>  <!-- Type van evidence, bv. “User/Customer Evidence”, “Market Data”, … -->

          
          <td style="max-width: 300px; white-space: normal;"> <!-- Beschrijving: max breedte zodat de tabel niet uitrekt; white-space: normal = tekst mag afbreken en meerdere lijnen vormen -->
            {{ ev.description }}
          </td>

          <!-- =========================
               BIJLAGE (LINK NAAR BRON)
               ========================= -->
          <td>  <!-- opent het bewijs in een nieuwe tab zodat je de app niet verlaat -->
            {% if ev.attachment_url %}    
              <a href="{{ ev.attachment_url }}"
                 target="_blank"                      
                 class="btn btn-base btn-vectr btn-sm">
                View File
              </a>
            {% else %}
              <span class="text-muted">No file</span>  <!-- duidelijk tonen dat er geen bestand is toegevoegd -->
            {% endif %}
          </td>

          <!-- =========================
               CONFIDENCE LABEL + WAARDE
               ========================= -->
          <td>
            <!-- Label is bv. “Market Data”, “Launch Data”… zodat de user niet enkel een getal ziet -->
            <strong>{{ label }}</strong><br>
            <small class="text-muted">
              {{ "%.2f"|format(ev.new_confidence or 0) }}  <!-- toont het ruwe getal (0.01, 2.00, 10.00, …) met 2 decimalen voor consistentie -->
            </small>
          </td>

          <!-- =========================
               ACTIE KNOPPEN: EDIT / DELETE
               ========================= -->
          <td>
            <div class="d-flex justify-content-center gap-2 flex-wrap">
              <!-- EDIT opent het formulier waar je deze evidence kan aanpassen -->
              <a href="{{ url_for('main.edit_evidence', evidence_id=ev.id_evidence) }}"  
                 class="btn btn-base btn-edit table-btn">
                Edit
              </a>

              <!-- DELETE stuurt een POST naar de delete-route.
                   onclick=confirm(...) toont een browser-popup “Weet je het zeker?”
                   → Dit voorkomt dat je per ongeluk bewijs verwijdert zonder bevestiging. -->
              <form action="{{ url_for('main.delete_evidence', evidence_id=ev.id_evidence) }}"
                    method="post"
                    class="form-inline">
                <button type="submit"
                        class="btn btn-base btn-danger-custom table-btn"
                        onclick="return confirm('Are you sure you want to delete this evidence?');">
                  Delete
                </button>
              </form>

            </div>
          </td>

        </tr>
        {% endfor %}

      </tbody>
    </table>

  {% endif %}

</div>

{% endblock %}
